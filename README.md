# js_spider

### nodejs 实现反爬虫

学习 http://geek.csdn.net/news/detail/85333

感谢作者的分享，还不知道他大名呢，因为之前也在思考这个问题（思考过加密解密，但由于前端源码可见，我们未做实施，这里给了很好的策略），当然我们不是针对反爬价格这种需求，而是[反黄牛砍价](http://tucao.doweidu.com/?/question/56)这种需求，而且后台也不是前端技术，这次分享是较成熟的方案。

关键的几个学习点，

- eval 方式让对方难破解
- 可以阿拉伯语言混淆
- 最关键还是实现猥琐而且其能自圆其说。关键说法是，我们加班少，对方加班多，人力成本等各种说法，这让实现得到价值体系！！！

实现方法：

- a 修改 url
- b 修改 key
- c 动态 key
- d 复杂动态 key（需计算）
- e 更复杂动态 key（引入加密解密，算法随机）

### 进一步复杂化，做浏览器检测

- 检测 IE 的 bug
- 检测 FF 的严格 innerText()
- 检测 Chrome 的强大特性 画个图 css3动画

### 我抓到你了——然后怎么办

- 不去引发生产事件——直接拦截
- 可能引发生产事件——给假数据（也叫投毒）


### 其他问题

- 放水：不要全部封死，死磕两败俱伤
- IP 被封：你没下钱，IP（几十万到100w）也就几十块钱
- 动态/拼接验证码： 一条验证码，也就1-3分钱

## 问题思考？

如果我们服务器端使用的不是 nodejs，那么算法 OK 么？

答：同样OK，服务器端最终返回 jsonp 形式的字符串数据，能让客户端执行就行了。怎么维护，就只能手动维护或提供个简单管理界面，直接编辑各种加解密算法，生成对应的 jsonp 内容。


如果用在app客户端呢？

答：由于以上算法，使用加解密以及 eval，是 js 操作的过程，如在 app 中起作用，需要为其单独处理下，否则只能 webview 种处理。

其他优化：对于同一个客户端类型（各种相同参数）限制请求阈值，超过即返回服务器忙

以上反爬虫方法，同样可针对黄牛砍价行为（其最可能就是使用模拟器对 api 接口直接请求处理，如此可阻止其行为）


## 扩展思考

要做普适性推广，我要写很多请求任务做测试，于是出了这个需求，我在文本框写一个请求任务的代码，点运行，就可以发起一个请求任务，这样我就非常方便测试了

并且还可以增加很多任务，一块儿做，可把任务存入本地缓存中，即使刷新也不会丢失自己刚写的代码（还可以维护一个任务列表）

如此我就新建任务就很方便了。此需求实现也很简单，引入 query，然后运行文本框代码即可。
