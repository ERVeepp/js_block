<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>测试 https 加载资源</title>
  <style>
  iframe{display: block;width: 400px; height: 200px;}
  </style>
  <script src="zepto.min.js"></script>
</head>
<body>
<h3>https 加载各种资源</h3>
<dl>
  <dt>全站 https 需要部署的项目：</dt>
  <dd>
<pre>
m.iqianggou.com
stats-m.iqianggou.com
m.haoshiqi.net
jingxuan.haoshiqi.net

以上站点及 app 内，会加载一些外部的静态资源，如用于协议、帮助等页面
www.iqianggou.com
www.haoshiqi.com
www.doweidu.com

通过iframe 加载外部 http资源，会被阻止加载
</pre>
  </dd>
</dl>
<ol>
  <li>加载 字体 资源，使用// 自动支持 ✔️</li>
  <li>请求 本站 api，通过 location.protocol 判断自动选择 ✔️</li>
  <li>百度统计，使用// 自动支持；growing 脚本也自动支持。支持加载 ✔️
    <p>使用 // 格式，在 https 协议下，会自动加载 // 对应的 https 资源</p>
    <script>
      if (!window._hmt) window._hmt = [];
      _hmt.push(['_setAutoPageview', false]);
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?dc887238fee1088e443acb020cd664f2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </li>
  <li>
    <h3>加载 img 资源 ⚠️</h3>
    <p>加载非 https图片，会给个警告，但网页可以正常显示图片</p>
    <img src="http://img-agc.iqianggou.com/f8f330abb4489745bda8ec3a36a6202e!180x180" alt="七牛">
    <img src="http://img1.iqianggou.com/assets/images/logo.png" alt="七牛">
    <img src="http://jingxuan.haoshiqi.net/assets/img/join-talent-bg.jpg" height="300" alt="非七牛">
  </li>
  <li>
    <h3>加载 iframe 资源 ❌</h3>
    <p>iframe 加载非 https 资源会被浏览器拦截，并报错，必须为 https 资源</p>
    <iframe src="http://www.iqianggou.com/mobile/agreement.html" width="" height=""></iframe>
  </li>
  <li>
    <h3>ajax请求 http资源</h3>
    <p>GEO百度城市 api</p>
    <button id='baidu'>百度 API</button>
    
    <p>高德定位 api</p>
    <button id='gaode'>高德 API</button>
  </li>
  <li>
  </li>
</ol>

<script>
function getId(id){
  return document.getElementById(id);
}
var btnBaidu = getId('baidu');
var btnGaode = getId('gaode');
var testHttpApi = function(){
  $.ajax({
    type: 'GET',
    url: 'http://api.v3.iqianggou.com/api/appconfig',
    // data: { name: 'Zepto.js' },
    dataType: 'json',
    timeout: 3000,
    // context: $('body'),
    success: function(data){
      // Supposing this JSON payload was received:
      //   {"project": {"id": 42, "html": "<div>..." }}
      // append the HTML to context object.
      console.log(data);
      alert('Ajax success!');
    },
    error: function(xhr, type){
      alert('Ajax error!');
    }
  })
}
btnBaidu.onclick = function(){
  // 请求 http api资源，随便一个测试即可
  // http://api.v3.iqianggou.com/api/appconfig GET
  console.log('baidu')
  testHttpApi()
}
btnGaode.onclick = function(){
  console.log('gaode');
  testHttpApi()
}
</script>
</body>
</html>
